<!--
  ========================LICENSE_START=================================
  screenit-huisartsenportaal
  %%
  Copyright (C) 2016 - 2021 Facilitaire Samenwerking Bevolkingsonderzoek
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  =========================LICENSE_END==================================
  -->
<div class="col-md-12">
    <div class="content">
        <h1>Overzicht Betalingen</h1>
        <div class="panel panel-default clearfix locatie-panel">
            <div class="panel-body">
                <form class="form-horizontal" ng-submit="form.zoeken(form.betalingenZoekObject, betalingform)"
                      name="betalingform">

                    <fieldset>
                        <div class="row">
                            <div class="col-sm-6">

                                <div class="form-group" show-errors>
                                    <label class="col-sm-4">Locatie:</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <ui-select ng-model="form.betalingenZoekObject.locatie">
                                                <ui-select-match placeholder="Kies er een....">
                                                    <span ng-class="{'text-danger' : $select.selected.status === 'INACTIEF'}">{{$select.selected.naam || $select.search}}</span>
                                                </ui-select-match>
                                                <ui-select-choices
                                                        repeat="locatie in (form.huisarts.locaties | filter: { naam: $select.search }) track by locatie.huisartsportaalId">
                                                <span ng-if="locatie.status === 'INACTIEF'"
                                                      class="label label-danger">verwijderd</span>
                                                    {{locatie.naam}}
                                                </ui-select-choices>
                                            </ui-select>

                                            <span class="input-group-btn">
                                      <button type="button" ng-click="form.betalingenZoekObject.locatie = undefined"
                                              class="btn btn-date btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                      </button>
                                    </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group" show-errors>
                                    <label class="col-sm-4">Naam client:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="text"
                                               ng-model="form.betalingenZoekObject.clientNaam"/>
                                    </div>
                                </div>

                                <div class="form-group" show-errors>
                                    <label class="col-sm-4">Betalingskenmerk:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="text"
                                               ng-model="form.betalingenZoekObject.betalingskenmerk"/>
                                    </div>
                                </div>

                            </div>
                            <div class="col-sm-6">

                                <div class="form-group"
                                     ng-class="{true: 'has-error', false: ''}[betalingform.VanafDatum.$invalid]">
                                    <label class="col-sm-4">Betalingsdatum vanaf:</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="dd-mm-jjjj"
                                                   name="VanafDatum" uib-datepicker-popup="{{form.dateformat}}"
                                                   ng-model="form.betalingenZoekObject.betalingsdatumVanaf"
                                                   is-open="form.betalingDatumPopupVanafOpen"
                                                   datepicker-options="dateOptions" current-text="Vandaag"
                                                   clear-text="Reset" close-text="Sluiten"/>
                                            <span class="input-group-btn">
                                            <button type="button" class="btn-date btn btn-default"
                                                    ng-click="form.open1()"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
                                        </div>
                                        <div ng-messages="betalingform.VanafDatum.$error"
                                             ng-if="!betalingform.VanafDatum.$pristine">
                                            <span ng-messages-include="assets/js/components/default-form-error.tmpl.html"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group"
                                     ng-class="{true: 'has-error', false: ''}[betalingform.TotenmetDatum.$invalid]"
                                     id="totenmet-datum-form-group">
                                    <label class="col-sm-4">Betalingsdatum t/m:</label>
                                    <div class="col-sm-8">
                                        <p class="input-group">
                                            <input name="TotenmetDatum" type="text"
                                                   thisearlierthan="form.betalingenZoekObject.betalingsdatumVanaf"
                                                   class="form-control" placeholder="dd-mm-jjjj"
                                                   uib-datepicker-popup="{{form.dateformat}}"
                                                   ng-model="form.betalingenZoekObject.betalingsdatumTotenMet"
                                                   is-open="form.betalingDatumPopuptmOpen"
                                                   datepicker-options="dateOptions" current-text="Vandaag"
                                                   clear-text="Reset" close-text="Sluiten"/>
                                            <span class="input-group-btn">
                                            <button type="button" class="btn-date btn btn-default"
                                                    ng-click="form.open2()"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
                                        </p>
                                        <div ng-messages="betalingform.TotenmetDatum.$error"
                                             ng-if="!betalingform.TotenmetDatum.$pristine">
                                            <span ng-messages-include="assets/js/components/default-form-error.tmpl.html"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group" show-errors>
                                    <div class="col-sm-offset-4 col-sm-8">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox"
                                                       ng-model="form.betalingenZoekObject.alleenZonderBetalingskenmerk"/>
                                                Alleen regels zonder betalingskenmerk
                                            </label>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="filter-btn-row">
                                <button class="btn btn-primary">Filteren</button>
                            </div>
                        </div>
                    </fieldset>
                </form>
                <hr>
                <div class="verrichtingen-export row">
                    <a class="btn btn-default btn-export" title="Exporteren" field-separator=";" csv-header="form.csvHeader"
                       filename="overzicht-betalingen.csv" ng-csv="form.getCsvExportData()" add-bom="true">Exporteren</a>
                </div>
                <div class="verrichtingen-table-container scroll-x">
                    <table ng-table="form.tableParams" template-pagination="pager-template" class="table table-verrichtingen table-striped table-hover">
                        <tr ng-repeat="row in $data track by row.huisartsportaalId">
                            <td data-title="'Huisartslocatie'" sortable="'huisartsLocatie.naam'">
                                {{row.verrichting.huisartsLocatieNaam}}
                            </td>
                            <td data-title="'Naam cli&euml;nt'" sortable="'clientNaam'">{{row.verrichting.clientNaam}}</td>
                            <td data-title="'Monster-id'" sortable="'monsterId'">{{row.verrichting.monsterId}}</td>
                            <td data-title="'Bedrag'" sortable="'bedrag'"
                                style="{{(row.debet) ? 'background-color: rgba(250,1,1,0.05);' : 'background-color: rgba(1,250,1,0.05);'}}">
                                {{row.bedragString}}
                            </td>
                            <td data-title="'Betalingsdatum'" header-class="'wrappable'" sortable="'betalingsdatum'">{{row.betalingsdatum | date:'dd-MM-yyyy'}}
                            <td data-title="'Betalingskenmerk'" sortable="'betalingsKenmerk'">{{row.betalingsKenmerk}}</td>
                            <td data-title="'Screeningsorganisatie'" sortable="'regio'">{{row.verrichting.regio}}</td>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="row tabel-totalen">
                    <strong>Aantal betaalregels:</strong> <span ng-bind="form.totalen.aantalBetalingen"></span>, <strong>Totaal
                    bedrag:</strong> <span ng-bind="form.totalen.totaalBedrag"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="pager-template">
    <div class="row">
        <div class="ng-cloak ng-table-pager">
            <ul class="pagination ng-table-pagination pull-right">
                <li ng-class="{'disabled': !page.active}" ng-repeat="page in pages" ng-switch="page.type">
                    <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">&laquo;</a>
                    <a ng-switch-when="first" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="page" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="more" ng-click="params.page(page.number)" href="">&#8230;</a>
                    <a ng-switch-when="last" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="next" ng-click="params.page(page.number)" href="">&raquo;</a>
                </li>
            </ul>
        </div>
    </div>
</script>
